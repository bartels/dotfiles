# Django dev environment setup
djstart() {
    module="$(basename $PWD)"
    if [ -z $1 ]; then
        project="$module"
    else
        project=$1
    fi

    # get absolute path
    pushd $(pwd)/../ > /dev/null
    RUNPATH="$(pwd -P)"
    popd > /dev/null

    # Run a subprocess
    (
        export PYTHONPATH="$RUNPATH:$PYTHONPATH" \
               DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE:-"$module.settings"} \
               DJANGO_ENV=${DJANGO_ENV:-"dev"}
        workon $project
        if [ $? -eq 0 ]; then
            tmux new-session -As $project
        fi
    )

}

# djstart command completion
_djstart_complete() {
    arg="${COMP_WORDS[COMP_CWORD]}"
    COMPREPLY=( $(ls -l $WORKON_HOME | grep ^d | awk '{print $NF}' | grep "$arg") )
}
complete -o default -o nospace -F _djstart_complete djstart

# Shortcut for running django-admin.py
dj() {
    django-admin.py "$@"
}

# dj command completion
complete -o default -F _django_completion dj
